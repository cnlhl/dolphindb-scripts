
def get_target_stock(start_date,end_date,target_stock,horizen){
    trans = loadTable("dfs://history","transBook")
    trans = select * from trans where Date>=start_date and Date<=end_date and StockCode=target_stock and CancelFlag="F"
    update trans set Timestamp=concatDateTime(Date,TransactionTime)
    trans = select last(Price)as Price from trans group by interval(Timestamp,horizen,"prev") as Time
    update trans set stock_return = eachPre(ratio,Price)-1
}

def readdata(filepath,start_date,end_date,horizen){
    file_in = loadText(filename=filepath,containHeader=true)
    names = columnNames(file_in)
    for(i in 1..size(names)){
        target_stock = s[i][1:]
        tmp_tb=table(file_in[s[0]],file_in[s[i]] as feature)
        tmp_trans=get_target_stock(start_date,end_date,target_stock,horizen)
        select * from tmp_tb left join tmp_trans on tmp_tb.Timestamp=tmp_trans.Time
        
    }
}

filepath = "/home/ddb/stock_data.csv"
tb=loadText(filepath,,,,,true)
tb

//tb1 = table(tb[s[0]],tb[s[1]])


